<?xml version="1.0" encoding="utf-8" ?>
<Defs>
  <VerbScript.VerbScriptDef>
    <defName>VS_SpiritGuardian</defName>
	<verbData>
		<potential>
			<isRace>Human</isRace>
		</potential>
		<allow>
		</allow>
		<fire>
			<if>
				<isNull>
					<loadLocal>SpiritGuardian_ToggleOn</loadLocal>
				</isNull>
				<saveLocal>
					<variableName>SpiritGuardian_ToggleOn</variableName>
					<variable><num>0</num></variable>
				</saveLocal>
			</if>
			
			<saveLocal>
				<variableName>SpiritGuardian_ToggleOn</variableName>
				<variable>
					<sub>
						<num>1</num>
						<loadLocal>SpiritGuardian_ToggleOn</loadLocal>
					</sub>
				</variable>
			</saveLocal>
			
			<while>
				<equal>
					<loadLocal>SpiritGuardian_ToggleOn</loadLocal>
					<num>1</num>
				</equal>
				<save>
					<variableName>DidDamage</variableName>
					<variable>
						<num>0</num>
					</variable>
				</save>
				<foreach>
					<selectRandom>
						<filter>
							<less>
								<distanceynormalized>
									<rootscope/>
									<topScope/>
								</distanceynormalized>
								<num>5</num>
							</less>
							<hostilepawnsinmap/>
						</filter>
					</selectRandom>
					<do>
						<damage>
							<damageType>Burn</damageType>
							<damageAmount>5</damageAmount>
						</damage>
						<spawndef>
							<spawnPosition>
								<topscope/>
							</spawnPosition>
							<spawnDef>Mote_LightningGlow</spawnDef>
							<scale>4</scale>
						</spawndef>
						<save>
							<variableName>DidDamage</variableName>
							<variable>
								<num>1</num>
							</variable>
						</save>
					</do>
				</foreach>
				<if>
					<equal>
						<load>DidDamage</load>
						<num>0</num>
					</equal>
					<spawndef>
						<spawnPosition>
							<rootscope/>
						</spawnPosition>
						<spawnDef>Mote_LightningGlow</spawnDef>
						<scale>4</scale>
					</spawndef>
				</if>
				<delay>30</delay>
			</while>
			
		</fire>
		<noTarget>true</noTarget>
		<repeatVerb>false</repeatVerb>
		<cooldownTicks>50</cooldownTicks>
		<label>Toggle Guardian Spirit</label>
		<description>A ghastly spirit will attack any hostile pawns nearby (5 tiles)</description>
		<icon>Things/Item/Equipment/WeaponRanged/MachinePistol</icon>
		<verbProps>
			<verbClass>VerbScript.Verb_Scripted</verbClass>
			<hasStandardCommand>true</hasStandardCommand>
			<warmupTime>0.5</warmupTime>
			<range>19.9</range>
			<soundCast>Shot_MachinePistol</soundCast>
			<soundCastTail>GunTail_Light</soundCastTail>
			<muzzleFlashScale>9</muzzleFlashScale>
			<targetParams>
				<canTargetLocations>true</canTargetLocations>
			</targetParams>
		</verbProps>
	</verbData>
  </VerbScript.VerbScriptDef>
</Defs>